<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>LIFFè‡ªå‹•ç™¼è¨Šæ¯</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h1>æ­£åœ¨è™•ç†ä¸­...</h1>

  <script>
    async function main() {
        await liff.init({ liffId: "2007338941-D63gmVoP" });

        // â­ å¦‚æœé‚„æ²’ç™»å…¥ï¼Œå°±ç™»å…¥ï¼Œä¸¦ä¸”å¼·åˆ¶è¦æ±‚ scope
        if (!liff.isLoggedIn()) {
            liff.login({
            scope: ['profile', 'chat_message.write'],   // ğŸ’¬ ç‰¹åˆ¥æ³¨æ„ï¼šé€™è£¡ä¸€å®šè¦å¸¶
            redirectUri: window.location.href           // â­ è®“å®ƒå›ä¾†é€™ä¸€é ï¼Œç¹¼çºŒå‹•ä½œ
            });
            return;  // login ä¹‹å¾Œé é¢æœƒé‡æ–°æ•´ç†ï¼Œæ‰€ä»¥é€™è£¡ return
        }

        try {
            await liff.sendMessages([
            {
                type: "text",
                text: "ğŸ‘‹ å“ˆå›‰ï¼é€™æ˜¯è‡ªå‹•ç™¼é€çš„è¨Šæ¯ï¼"
            }
            ]);
            alert("è¨Šæ¯å·²æˆåŠŸç™¼é€ï¼");
            liff.closeWindow();  // æˆåŠŸå¾Œé—œæ‰
        } catch (err) {
            console.error('ç™¼é€å¤±æ•—', err);

            if (err.message && err.message.includes('user doesn\'t grant required permissions')) {
            // ğŸ›‘ å¦‚æœçœŸçš„æ²’æˆæ¬Šï¼Œè¦é‡æ–°ç™»å…¥ä¸€æ¬¡
            alert('æ‚¨å°šæœªæˆæ¬Šç™¼é€è¨Šæ¯ï¼Œè«‹åŒæ„æˆæ¬Šï¼');
            liff.logout();
            liff.login({
                scope: ['profile', 'chat_message.write'],
                redirectUri: window.location.href
            });
            } else {
            alert("ç™¼ç”Ÿå…¶ä»–éŒ¯èª¤ï¼Œè«‹é‡æ–°å˜—è©¦ï¼");
            }
        }
        }
  </script>
</body>
</html>
